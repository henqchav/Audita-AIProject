---
import { isAuthenticated } from '../utils/auth';

---

<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <title>App - Audita</title>
    </head>
    <body class="bg-dark-bg text-text-primary">
        <header class="flex justify-between items-center p-4 bg-dark-surface text-text-primary">
            <div></div>
            <h1 class="text-center text-2xl">AUDITA</h1>
            <button
                id="logout"
                class="px-4 py-2 bg-accent-error rounded"
            >
                Log Out
            </button>
        </header>
        <main class="flex justify-center items-center h-screen">
            <button id="auditButton" class="px-8 py-4 bg-accent-primary text-text-primary rounded transition-transform transform hover:scale-105">
                Auditar audio
            </button>
        </main>
        <footer class="text-center p-4 bg-dark-surface text-text-secondary">
            created by henqchav
        </footer>

        <!-- Modal -->
        <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden">
            <div class="bg-dark-surface p-6 rounded-md w-1/3 relative">
                <button id="closeModal" class="absolute top-2 right-2 text-text-primary">X</button>
                <h2 class="text-center text-text-primary mb-4">Sube tu archivo</h2>
                <div id="dropZone" class="border-2 border-dashed border-text-secondary p-4 text-center">
                    <p class="text-text-secondary">Arrastra tu archivo aquí</p>
                    <p class="text-text-secondary">o</p>
                    <button id="fileSelectButton" class="text-accent-primary underline">Selecciona tu archivo</button>
                    <input type="file" id="fileInput" class="hidden" accept=".mp3, .wav" />
                </div>
                <button id="validateButton" class="mt-4 px-4 py-2 bg-accent-primary text-text-primary rounded hidden">Validar</button>
            </div>
        </div>
    </body>
</html>

<script type="module">
    const isAuth = localStorage.getItem('auth') === 'true';
    
    if (!isAuth) {
        window.location.href = '/';
    } else {
        document.getElementById('app-content')?.classList.remove('hidden');
    }

    document.getElementById('logout')?.addEventListener('click', () => {
        localStorage.removeItem('auth');
        window.location.href = '/';
    });

    const auditButton = document.getElementById('auditButton');
    const modal = document.getElementById('modal');
    const closeModal = document.getElementById('closeModal');
    const fileInput = document.getElementById('fileInput');
    const fileSelectButton = document.getElementById('fileSelectButton');
    const dropZone = document.getElementById('dropZone');
    const validateButton = document.getElementById('validateButton');

    auditButton.addEventListener('click', () => {
        modal.classList.remove('hidden');
    });

    closeModal.addEventListener('click', () => {
        modal.classList.add('hidden');
    });

    fileSelectButton.addEventListener('click', () => {
        fileInput.click();
    });

    fileInput.addEventListener('change', (event) => {
        handleFile(event.target.files[0]);
    });

    dropZone.addEventListener('dragover', (event) => {
        event.preventDefault();
        dropZone.classList.add('bg-gray-700');
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('bg-gray-700');
    });

    dropZone.addEventListener('drop', (event) => {
        event.preventDefault();
        dropZone.classList.remove('bg-gray-700');
        handleFile(event.dataTransfer.files[0]);
    });

    function handleFile(file) {
        if (file && (file.type === 'audio/mp3' || file.type === 'audio/wav')) {
            validateButton.classList.remove('hidden');
        } else {
            alert('Por favor, sube un archivo de audio válido (.mp3 o .wav)');
        }
    }

    validateButton.addEventListener('click', () => {
        const file = fileInput.files[0];
        if (file && (file.type === 'audio/mp3' || file.type === 'audio/wav')) {
            alert('Archivo válido');
        } else {
            alert('Archivo no válido');
        }
    });
</script>